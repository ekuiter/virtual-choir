<If "%{REMOTE_ADDR} != '127.0.0.1' && %{REMOTE_ADDR} != '::1'">
    AuthType Basic
    AuthName "Virtueller Chor"
    AuthUserFile /var/www/html/.htpasswd
    Require valid-user

    RewriteEngine On
    RewriteCond %{HTTPS} != on
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</If>